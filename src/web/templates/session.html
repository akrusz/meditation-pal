{% extends "base.html" %}

{% block title %}Session - Glooow{% endblock %}

{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>
{% endblock %}

{% block nav_center %}
<div class="nav-session-info">
    <div class="orb orb-breathing orb-nav" id="orb"></div>
    <span class="session-timer" id="timer">0:00</span>
</div>
{% endblock %}

{% block content %}
<div class="session-container">
    <div class="conversation" id="conversation">
        <!-- Messages appear here -->
    </div>

    <div class="typing-indicator" id="typing-indicator">
        <span></span><span></span><span></span>
    </div>

    <div class="input-area">
        <div class="input-row">
            <div id="voice-status" class="voice-status">Initializing...</div>
            <button id="voice-btn" class="btn btn-voice" title="Toggle microphone — say &quot;pause&quot; or &quot;mute&quot; to disable">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
        </div>
        <div class="input-controls">
            <label class="toggle-label" title="Read responses aloud">
                <input type="checkbox" id="tts-toggle" checked>
                <span class="toggle-text">Speak Aloud</span>
            </label>
            <div class="ember-level" title="Floating ember particles">
                <span class="toggle-text">Embers</span>
                <button class="ember-btn" id="ember-minus" type="button">−</button>
                <div class="ember-blocks" id="ember-blocks">
                    <span class="ember-block filled" data-level="1"></span>
                    <span class="ember-block" data-level="2"></span>
                    <span class="ember-block" data-level="3"></span>
                </div>
                <button class="ember-btn" id="ember-plus" type="button">+</button>
            </div>
            <label class="toggle-label" title="Kasina gazing mode">
                <input type="checkbox" id="kasina-toggle">
                <span class="toggle-text">Kasina</span>
            </label>
            <div class="speed-control" title="Speech rate">
                <label class="speed-label" for="speed-slider">Speed</label>
                <input type="range" id="speed-slider" min="70" max="150" value="110" step="10">
            </div>
            <div class="voice-control">
                <button type="button" id="voice-picker-btn" class="voice-picker-btn">Voice</button>
            </div>
            <button id="end-btn" class="btn btn-end">End Session</button>
        </div>
    </div>
</div>

<div class="ember-container" id="ember-container"></div>

<div class="voice-modal-overlay" id="voice-modal" style="display: none;">
    <div class="voice-modal">
        <div class="voice-modal-header">
            <span class="voice-modal-title">Choose Voice</span>
            <button type="button" class="voice-modal-close" id="voice-modal-close">&times;</button>
        </div>
        <div class="voice-modal-list" id="voice-modal-list">
            <!-- populated by JS -->
        </div>
        <div class="voice-modal-footer">
            <label class="voice-modal-speed-label" for="modal-speed-slider">Speed</label>
            <input type="range" id="modal-speed-slider" min="70" max="150" value="110" step="10">
        </div>
    </div>
</div>

<div class="session-ended-overlay" id="session-ended" style="display: none;">
    <div class="session-ended-content">
        <div class="orb orb-idle"></div>
        <p id="closer-text"></p>
        <div class="session-ended-actions">
            <a href="/" class="btn btn-primary">New Session</a>
            <a href="/history" class="btn btn-secondary">View History</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/session.js') }}"></script>
{% endblock %}
